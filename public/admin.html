<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Leads Admin</title>
    <style>
      body{font-family:Inter,system-ui,Segoe UI,Helvetica,Arial;color:#222;margin:20px}
      .row{display:flex;gap:8px;align-items:center}
      input,button{padding:8px;font-size:14px}
      pre{background:#f6f8fa;padding:12px;border-radius:6px;overflow:auto}
    </style>
  </head>
  <body>
    <h1>Leads & Delivery Statuses</h1>
    <div class="row">
      <label for="key">Admin API Key</label>
      <input id="key" placeholder="Paste ADMIN_API_KEY here (x-admin-key or Bearer)" style="flex:1" />
      <button id="load">Load</button>
    </div>

    <h2>Leads</h2>
    <div id="leads"></div>

    <h2>Delivery Statuses</h2>
    <div id="statuses"></div>

    <h2>Webhook Events</h2>
    <div id="events"></div>

    <script>
      const $ = (id) => document.getElementById(id);
      function renderList(el, items){
        if(!items || !items.length){ el.innerHTML = '<em>None</em>'; return }
        el.innerHTML = '';
        items.forEach(it => {
          const pre = document.createElement('pre');
          pre.textContent = JSON.stringify(it, null, 2);
          el.appendChild(pre);
        });
      }

      async function load() {
        const key = $('key').value.trim();
        if(!key){ alert('Enter admin key'); return }
        const headers = { 'x-admin-key': key };
        if(key.toLowerCase().startsWith('bearer ')){
          headers['authorization'] = key;
        }

        try{
          const res = await fetch('/admin/leads',{ headers });
          if(res.status===401 || res.status===403){
            alert('Unauthorized - check ADMIN_API_KEY');
            return;
          }
          const data = await res.json();
          renderList($('leads'), data.leads || []);
          renderList($('statuses'), data.deliveryStatuses || []);
          renderList($('events'), data.webhookEvents || []);
        }catch(e){
          alert('Failed to load: '+e.message);
        }
      }
      $('load').addEventListener('click', load);
    </script>
  </body>
</html>
